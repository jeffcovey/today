#!/usr/bin/env node
/**
 * Resolve a city, country, or timezone string to a valid timezone.
 * Uses the system's timezone database via Intl API.
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';
import { findTimezone } from '../src/timezone-resolver.js';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

function main() {
  let inputTz;

  if (process.argv.length < 3) {
    // Read from config
    const configPath = path.join(__dirname, '..', 'config.toml');
    try {
      const configContent = fs.readFileSync(configPath, 'utf-8');
      // Simple TOML parsing for timezone key
      const match = configContent.match(/^timezone\s*=\s*["']([^"']+)["']/m);
      inputTz = match ? match[1] : 'America/New_York';
    } catch {
      inputTz = 'America/New_York';
    }
  } else {
    inputTz = process.argv.slice(2).join(' ');
  }

  const result = findTimezone(inputTz);
  console.log(result);
}

main();
