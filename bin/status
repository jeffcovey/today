#!/bin/bash

# Show today's task status from review file

# Get date components for new naming scheme
TODAY_DATE=$(date +%Y-%m-%d)
YEAR=$(date +%Y)
MONTH=$(date +%m)
DAY=$(date +%d)
# Determine quarter from month
if [ $MONTH -le 3 ]; then Q="Q1"
elif [ $MONTH -le 6 ]; then Q="Q2"
elif [ $MONTH -le 9 ]; then Q="Q3"
else Q="Q4"
fi
REVIEW_FILE="plans/${YEAR}-${Q}-${MONTH}-${DAY}.md"

if [ ! -f "$REVIEW_FILE" ]; then
    echo "âŒ No review file for today. Run 'bin/today' first."
    exit 1
fi

echo "ğŸ“Š Today's Progress ($TODAY_DATE)"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Count completed vs total tasks
TOTAL=$(grep -E "^- \[ \]|^- \[x\]|^[0-9]+\." "$REVIEW_FILE" | wc -l)
COMPLETED=$(grep -E "âœ“" "$REVIEW_FILE" | wc -l)

echo "ğŸ“ˆ Progress: $COMPLETED/$TOTAL tasks completed"
echo ""

# Show completed tasks
if [ $COMPLETED -gt 0 ]; then
    echo "âœ… Completed:"
    grep "âœ“" "$REVIEW_FILE" | sed 's/^/   /'
    echo ""
fi

# Show pending tasks
PENDING=$(grep -E "^- \[ \]|^[0-9]+\." "$REVIEW_FILE" | grep -v "âœ“")
if [ ! -z "$PENDING" ]; then
    echo "â³ Pending:"
    echo "$PENDING" | head -10 | nl -w2 -s". " | sed 's/^/   /'
    echo ""
fi

echo "ğŸ“ Review file: $REVIEW_FILE"
echo ""
echo "Commands:"
echo "  bin/mark-done <task or number>  # Mark task as complete"
echo "  bin/today                        # Get updated recommendations"
echo "  bin/progress <note>              # Add a progress note"