#!/usr/bin/env node

// Script to encode/decode Google service account JSON for .env storage

import fs from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function encodeServiceAccount() {
  const keyPath = path.join(__dirname, '..', 'google-calendar-key.json');
  
  try {
    // Read the JSON file
    const jsonContent = await fs.readFile(keyPath, 'utf-8');
    
    // Parse to validate it's valid JSON
    const parsed = JSON.parse(jsonContent);
    
    // Convert to base64
    const base64 = Buffer.from(jsonContent).toString('base64');
    
    console.log('üìù Add this to your .env file:');
    console.log('');
    console.log(`GOOGLE_SERVICE_ACCOUNT_KEY=${base64}`);
    console.log('');
    console.log('‚úÖ You can now:');
    console.log('1. Remove the line: GOOGLE_SERVICE_ACCOUNT_KEY_PATH=./google-calendar-key.json');
    console.log('2. Delete the google-calendar-key.json file (it\'s now embedded in .env)');
    console.log('3. Run: npx dotenvx encrypt');
    
  } catch (error) {
    if (error.code === 'ENOENT') {
      console.error('‚ùå google-calendar-key.json not found');
      console.error('   Download it from Google Cloud Console first');
    } else {
      console.error('Error:', error.message);
    }
    process.exit(1);
  }
}

// Run the encoder
encodeServiceAccount();