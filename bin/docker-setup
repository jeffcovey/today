#!/bin/bash

echo "ğŸš€ Today CLI - Docker Setup"
echo "=========================="
echo ""

# Check if .env.local exists
if [ ! -f .env.local ]; then
    echo "ğŸ“ Creating .env.local file..."
    echo ""
    echo "Please enter your DOTENV_PRIVATE_KEY:"
    echo "(You can find this on your local machine with: echo \$DOTENV_PRIVATE_KEY)"
    echo ""
    read -p "DOTENV_PRIVATE_KEY: " DOTENV_KEY
    
    echo "DOTENV_PRIVATE_KEY=$DOTENV_KEY" > .env.local
    echo "# SKIP_DEP_CHECK=true  # Uncomment to skip dependency checks" >> .env.local
    echo ""
    echo "âœ… Created .env.local"
else
    echo "âœ… Found existing .env.local"
fi

echo ""
echo "ğŸ“¦ Building Docker container..."
docker-compose --env-file .env.local build

echo ""
echo "ğŸ¯ Starting container..."
docker-compose --env-file .env.local up -d

echo ""
echo "âœ… Setup complete!"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Available commands:"
echo ""
echo "  bin/docker-run exec     # Enter the container"
echo "  bin/docker-run restart  # Restart after updates"
echo "  bin/docker-run down     # Stop the container"
echo "  bin/docker-run logs     # View container logs"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ” IMPORTANT: Claude Authentication Required"
echo ""
echo "After entering the container, you MUST authenticate Claude:"
echo "  1. Run: bin/docker-run exec"
echo "  2. Inside container, run: claude"
echo "  3. Follow the browser prompt to login"
echo ""
echo "Then you can use:"
echo "  bin/sync                # Sync all data"
echo "  bin/today               # Run daily review"
echo "  bin/status              # Check task progress"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"