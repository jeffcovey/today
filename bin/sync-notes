#!/bin/bash

# Script to sync notes bidirectionally with GitHub
# Pulls latest notes from other devices and pushes local changes

echo "ðŸ“ Syncing notes with GitHub..."

# Ensure we're in the right directory
cd "$(dirname "$0")/.." || exit

# Check for local changes
if [[ -n $(git status notes/ --porcelain 2>/dev/null) ]]; then
    echo "ðŸ“¤ Pushing local note changes..."
    git add notes/
    git commit -m "Sync local notes" 2>/dev/null
    git push origin main
fi

# Pull latest changes
echo "ðŸ“¥ Pulling latest notes..."
git pull origin main

# Clean up empty files
echo "ðŸ§¹ Cleaning up empty files..."
find notes -type f -empty -delete 2>/dev/null
deleted_count=$(git status --porcelain notes/ | grep -c "^ D " || true)
if [[ $deleted_count -gt 0 ]]; then
    echo "  Removed $deleted_count empty file(s)"
    git add notes/
    git commit -m "Clean up empty note files" 2>/dev/null
    git push origin main 2>/dev/null
fi

# Show recent notes
echo ""
echo "ðŸ“š Recent notes:"
find notes -type f -name "*.md" -mtime -7 2>/dev/null | head -10

echo ""
echo "âœ… Notes synced successfully!"