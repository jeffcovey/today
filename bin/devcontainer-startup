#!/bin/bash
# Main startup script for devcontainer
set -e

echo "=== DevContainer Startup ==="
echo "Project: $(basename "$(pwd)")"
echo "Time: $(date)"

# Setup local mounts from mounts.local (if configured)
if [ -f ".devcontainer/setup-mounts.sh" ]; then
    bash .devcontainer/setup-mounts.sh
fi

# Run setup scripts using unified setup command
if [ -f "bin/setup" ]; then
    echo "Setting up SSH..."
    bash bin/setup --ssh || echo "SSH setup failed, continuing..."
fi

# Check vault mount status
if [ -d "/workspaces/today/vault" ]; then
    if [ -n "$(ls -A /workspaces/today/vault 2>/dev/null)" ]; then
        echo "✅ Vault mounted from host ($(ls /workspaces/today/vault | wc -l) items)"
    else
        echo "⚠️  Vault directory exists but appears empty"
        echo "   Configure mounts in .devcontainer/mounts.local"
    fi
else
    echo "ℹ️  No vault mounted - creating empty vault directory"
    mkdir -p /workspaces/today/vault
fi

echo ""
echo "DevContainer startup complete!"
echo "Run 'bin/today' to start an interactive session."
