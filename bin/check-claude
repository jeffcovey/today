#!/bin/bash

# Script to check Claude CLI authentication status

echo "üîê Checking Claude CLI authentication..."
echo ""

# Test by actually trying to use Claude in non-interactive mode
TEST_RESPONSE=$(claude --print "Say 'ok'" 2>&1)

if echo "$TEST_RESPONSE" | grep -q "Invalid API key\|Please run /login\|not authenticated"; then
    echo "‚ö†Ô∏è  Claude is NOT authenticated"
    echo ""
    echo "To authenticate:"
    echo "  1. Run: claude"
    echo "  2. Follow the browser prompt to login"
    echo "  3. Your authentication will persist between container restarts"
    echo ""
    echo "Note: Authentication is stored in ~/.config/claude/"
    exit 1
else
    echo "‚úÖ Claude is authenticated and ready to use"
    echo ""
    claude --version
fi