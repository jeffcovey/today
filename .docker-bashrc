#!/bin/bash

# Enable color support
export TERM=xterm-256color

# Set up a colorful prompt with container name
export PS1='\[\033[01;32m\]üê≥today\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\] \[\033[01;33m\]$\[\033[00m\] '

# Aliases for colorful output
alias ls='ls --color=auto'
alias ll='ls -alF --color=auto'
alias la='ls -A --color=auto'
alias l='ls -CF --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# Git aliases
alias gs='git status'
alias gp='git pull'
alias gpu='git push'
alias gd='git diff'
alias gl='git log --oneline -10'

# Project-specific aliases
alias sync='bin/sync'
alias today='bin/today'
alias status='bin/status'
alias progress='bin/progress'

# Configure git identity from config.toml if available
if ! git config user.email > /dev/null 2>&1; then
    if [ -f "bin/get-config" ] && [ -f "config.toml" ]; then
        CONFIG_NAME=$(bin/get-config profile.name 2>/dev/null)
        CONFIG_EMAIL=$(bin/get-config profile.email 2>/dev/null)
        if [ -n "$CONFIG_NAME" ] && [ -n "$CONFIG_EMAIL" ]; then
            git config --global user.email "$CONFIG_EMAIL"
            git config --global user.name "$CONFIG_NAME"
            echo "‚úì Git identity set from config.toml: $CONFIG_NAME <$CONFIG_EMAIL>"
        else
            echo "‚ö†Ô∏è  Git identity not configured. Run:"
            echo "   git config --global user.email 'your@email.com'"
            echo "   git config --global user.name 'Your Name'"
            echo "   Or add 'email' to [profile] section in config.toml"
        fi
    else
        echo "‚ö†Ô∏è  Git identity not configured. Run:"
        echo "   git config --global user.email 'your@email.com'"
        echo "   git config --global user.name 'Your Name'"
    fi
fi

# Welcome message
echo ""
echo "üöÄ Welcome to Today CLI Container!"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "Quick commands:"
echo "  today    - Run daily review"
echo "  sync     - Sync all data"
echo "  status   - Check task progress"
echo "  gp       - Git pull"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""

# Check if Claude is authenticated
TEST_RESPONSE=$(echo "test" | claude 2>&1 | head -1)
if echo "$TEST_RESPONSE" | grep -q "Invalid API key\|Please run /login\|not authenticated"; then
    echo "‚ö†Ô∏è  Claude CLI needs authentication!"
    echo "   Run: claude"
    echo "   Then follow the browser prompt to login"
    echo ""
fi

# Set working directory reminder
echo "üìÅ Working directory: $(pwd)"
echo ""