# Database Cleanup Plugin
# Performs various database maintenance tasks to keep things tidy

name = "database-cleanup"
displayName = "Database Cleanup"
description = "Database maintenance: clean old backups, vacuum, prune stale data"
type = "utility"

requiredEnv = []

longDescription = """
Automatically performs database maintenance tasks during sync:
- Clean old backup files (by count and/or total size)
- Delete empty/stale database files
- VACUUM database to reclaim unused space
- Prune old sync_metadata entries

Enabled by default to prevent disk bloat. Disable by setting enabled = false.
"""

[commands]
read = "./read.js"

[settings]
# Directory containing database files
data_directory = { type = "string", default = ".data" }

# --- Backup file cleanup ---
# Maximum number of backup files to keep (oldest deleted first)
# Set to 0 to disable
max_backups = { type = "number", default = 5 }

# Maximum total size of .data directory in MB before cleanup triggers
# Set to 0 to disable
max_data_size_mb = { type = "number", default = 500 }

# Delete empty/stale database files (0-byte .db files)
delete_empty_files = { type = "boolean", default = true }

# --- Database optimization ---
# Run VACUUM to reclaim unused space
vacuum = { type = "boolean", default = true }

# --- Data retention ---
# Delete sync_metadata entries older than N days (0 = keep all)
sync_metadata_retention_days = { type = "number", default = 90 }
